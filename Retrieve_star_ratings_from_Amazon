# importing packages
from bs4 import BeautifulSoup
import requests

# update user agent, look at the scraping again

def retrieve_star_ratings_from_Amazon(url,
                                      headers = {'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36',
                                                 'accept-language': 'cs-CZ,cs;q=0.9'}):
    

    response = requests.get(url, headers=headers)

    if response.status_code != 200:
        print(f"Failed to retrieve page with status code: {response.status_code}")

    else:
        soup = BeautifulSoup(response.text, 'lxml')
        
        title_element = soup.select_one('#productTitle')
        
        if title_element:
            title = title_element.text.strip()
            
        else:
            print("Failed to find the title element.")
            title = None
            
        no_of_ratings_element = soup.select_one('#acrCustomerReviewText')
        
        if no_of_ratings_element:
            
            no_of_ratings = int(no_of_ratings_element.text.replace(' ratings', '').replace(',', '').strip())
            
        else:
            print("Failed to find the number of ratings element.")
            no_of_ratings = None
        
        star_reviews_hist = soup.select_one('#cm_cr_dp_d_rating_histogram')
    
        if star_reviews_hist:

            a_tags = star_reviews_hist.find_all('a')
            aria_labels = [a.get('aria-label') for a in a_tags if a.get('aria-label')]
            
        return aria_labels, no_of_ratings, title
        
        else:
            print("Failed to find the rating histogram section.")
            aria_labels = None

# Output
#aria_labels, no_of_ratings, title = retrieve_star_ratings_from_Amazon()

